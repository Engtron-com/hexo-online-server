<link rel="stylesheet" href="/css/editormd.min.css" />
<script src="/editormd.min.js"></script>
<div style="width: 20%;position: fixed;top: 65px;bottom: 0;">
    <div style="width: 100%;height: 5%;">
        <a name="new" href="/shell?action=new_page" wss type="button" class="btn btn-default">新建</a>
        <a name="save" href="/shell?action=save_page" wss type="button" class="btn btn-default" page-id="#">保存</a>
    </div>
    <div style="width: 100%;height: 95%;overflow-x: hidden;overflow-y: scroll;">
        <% pages.forEach(function(page){ %>
            <a href="#<%= page %>" class="list-group-item" page><%= page %></a>
        <% }); %>
    </div>
</div>
<div class="btn-group" style="position: fixed;top: 65px;margin-left: 20%;width: 80%;">
    <div class="el-form-item__content" style="width:100%;height:5%;background-color: #f3f3f3;">
        <div class="input__title flex1 el-input" style="width: 80%;height: 38px;float: left;">
            <input type="text" style=" width: 100%;height: 38px;border: 0;background: #ffffff;color: #4d4d4d;" autocomplete="off" id="txtTitle" post-id="#" maxlength="100" placeholder="2020-11-18" class="el-input__inner"/>
            <!-- <span class="el-input__suffix"><span class="el-input__suffix-inner">
            <span class="el-input__count"><span class="el-input__count-inner">10/100</span></span></span>
            </span> -->
        </div>
        <div class="article-bar__user-box flex flex--row flex--align-center" style="width: 20%;display: flex;flex-direction: row;float: left;justify-content: center;">
            <button type="button" style="border: 1px solid #cccccc; margin: 0 10px;" class="el-button btn btn-save el-button--text">保存</button>
            <button type="button" style="border: 1px solid #cccccc; margin: 0 10px;" class="el-button btn btn-publish el-button--primary">发布</button>
        </div>
    </div>
    <!-- <a name="rename" href="/shell?action=rename_post" wss type="button" class="btn btn-default" post-id="#">重命名</a> -->
    <div id="editor" style="width: 100%;height:95%;">
    </div>
</div>

<script>
    $(".list-group-item").bind("click", function () {
        $(".list-group-item").removeClass("active");
        $(this).addClass("active");
    });
    $("a[page]").bind("click", function () {
        let pageId = $(this).attr("href");
        $.get('/getPage', {
            page: pageId
        }, function (data, status, xhr) {
            if (status === "success" && data.success) {
                var editor = editormd("editor", {
                    width: "100%",
                    height: "95%",
                    markdown: data.data, // dynamic set Markdown text
                    path: "/lib/" // Autoload modules mode, codemirror, marked... dependents libs path
                });
                $('a[page-id]').attr("page-id", pageId);
                let autoSaveTime = <%= autoSave %> ;
                if (autoSaveTime) {
                    if (window.autoSave) clearInterval(window.autoSave);
                    window.autoSave = setInterval(() => {
                        $.post($('a[name="save"]').attr("href"), {
                            page: $('a[name="save"]').attr("page-id"),
                            data: $(".editormd-markdown-textarea").val()
                        });
                    }, autoSaveTime);
                }
            } else {
                swal("\n获取页面失败", "error");
            }
        });
    });
    $("a[wss]").bind("click", function () {
        let href=$(this).attr("href");
        switch ($(this).attr("name")) {
            case "new":
                alertify
                    .okBtn("确定")
                    .cancelBtn("取消")
                    .prompt("请输入页面路径：",
                        function (val, ev) {
                            ev.preventDefault();
                            if (val) $.get(href, {
                                page:val
                            });
                        });
                break;
            case "delete":
                $.get(href, {
                    page: $(this).attr("page-id")
                });
                break;
            case "save":
                $.post(href, {
                    page: $(this).attr("page-id"),
                    data: $(".editormd-markdown-textarea").val()
                });
                break;
            default:
                swal("未知操作", "error");
                break;
        }
        return false;
    });


</script>